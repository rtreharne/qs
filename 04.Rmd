---
output:
  pdf_document: default
  html_document: default
---
\newpage

# Introduction to R: Part I

If you are currently participating in a timetabled BIOS103 QS workshop, please ensure that you cover **all of this section's content** and complete this week's **formative and summative assessments** in the BIOS103 Canvas Course.

We are going to diverge from what you have been doing in the labs this week in order to focus on introducing you to R. Our learning objectives are as follows:

- Start a new R Project in R Studio
- Read a dataset to a variable
- Inspect a dataset
- Filter (subset) a dataset based on column values
- Create summary tables of descriptive statistics
- Sort a table

You should have completed section \@ref(getting-ready-for-R) already and have R and R Studio installed on your personal machine. If you are unable to install R and RStudio then please use one of the University computers.

## Reading and Inspecting Data

This week we're going to be using the fantastic Pantheria dataset

1. **Open RStudio and start a new project**

2. **Download the data** from [here](http://canvaswizards.org.uk/dataspell/pantheria/999) (or right click, save as from [here](https://raw.githubusercontent.com/rtreharne/qs/refs/heads/main/data/04/pantheria_999.csv)). 

3. **Copy the downloaded file** into your RStudio project directory (folder). You should see the file appear in your **Files** window in the bottom-right corner of RStudio.

4. **Create a new R script file** and save it with a sensible filename (e.g. pantheria_summary.R)

5. **Read the data** to a [variable](#what-is-a-variable) called `pantheria_data`: In your new script file, write the following line of code on line 1:

```{r eval=FALSE, class.source = "numberLines"}
pantheria_data <- read.csv("pantheria_999.csv")
```
Run the line by clicking anywhere on the line and clicking the **run** button or by pressing **Ctrl+Enter** on your keyboard. You should see a new line appear in your **Environment** window in the top-right of your RStudio like in figure \@ref(fig:environment-window). If you don't see it then the here are the most common reasons as to why:

- You haven't used quotation marks around your data filename
- You've mis-spelled your filename
- You haven't put your data file in the correct folder
- You didn't create an R project first.

```{r environment-window, echo=FALSE, fig.cap="Details of your data variable should appear in your environment window after running line 1.", out.width="100%"}
knitr::include_graphics("img/04/environment.png")
```

```{r pantheria, echo=FALSE, fig.cap="By clicking on your data variable in your environment window you can inspect the data in RStudio", out.width="100%"}
knitr::include_graphics("img/04/pantheria.png")
```
><h3 id="what-is-a-variable">What is a variable in R?</h3>
>A variable in R is a symbolic name representing a value stored in memory. Variables are created by assigning values using `<-`.
>
>**Naming Convention**
>I prefer using lowercase words for variable names. If multiple words are needed, I separate them with an underscore (_), avoiding spaces. For example: my_variable.
>
>**Best Practices**
>
> - Descriptive Names: Choose clear, meaningful names.
> - Consistency: Use the same naming style throughout your code.
> - Avoid Reserved Words: Don’t use R’s reserved keywords (`if`, `else`, `for`, etc.)
> - Uniqueness: Ensure variable names are unique within your environment.
>
>These practices enhance code readability and maintainability.


Well done if you can see your data! Now the world is your oyster, as they say. From here you can go in any number of directions and use R to summarise, visualise and analyse your data in order to gain novel insights.

Let's start small by asking the very simple question - "What **order** of mammal occurs the most frequently (has the most number of rows) in the dataset?".

To answer this question, I need to go through my data row by row and count how many times a row corresponding to each order (e.g. Dermoptera, Chiroptera, Rodentia etc ...) appears. Let's extend my R script as follows:

```{r eval=FALSE, class.source = "numberLines"}
pantheria_data <- read.csv("pantheria_999.csv")

orders <- table(data$Order)

print(orders)
```

Let's break these additional lines down, step-by-step:

- **Firstly**, you'll notice that I've left lines 2 and 5 blank. You don't need to do this, but I like to because it gives my code a bit of breathing space and is often easier to identify a problem later.

- **In line 3**, I'm using the `table()` [function](#what-is-a-function) to count the number of times a unique value in my order column appears. By putting `data$Order` inside the table function's brackets we are "passing" it all of the values in the **order** column as a big list. I'm then assigning the output of the table function to a new variable called `orders` so that I can refer to it later.

- **Lastly in line 5**, I'm using a print function to output the contents `orders` to my console as shown in figure \@ref(fig:console-output-order)

```{r console-output-order, echo=FALSE, fig.cap="When using `print(orders)` the following should appear in my RStudio console.", out.width="100%"}
knitr::include_graphics("img/04/orders-output.png")
```

><h3 id="what-is-a-function">What is a function in R?</h3>
>A function in R is a set of instructions that performs a specific task or calculation, taking inputs (arguments) and returning an output (result). So far in this course, we have used three pre-defined functions: read.csv() to read data from a CSV file, table() to summarise categorical data, and print() to display output in the console. While these functions are built into R, we can also create our own functions when we need to perform customised tasks—more on this later in the course.

You can see by inspecting your console output that the order **Rodentia** is the most frequently occurring order with **549** rows in the data. 

But what if there were lots more orders? It might not be so straightforward. Let's get our R script to pick out the most frequently occurring order for us:
```{r eval=FALSE, class.source = "numberLines"}
pantheria_data <- read.csv("pantheria_999.csv")

orders <- table(data$Order)

most_common_order <- names(which.max(orders))

print(most_common_order)
```

I've inserted the line `most_common_order <- names(which.max(orders))` at line 5. Let's break it down:

1. `which.max(orders)`:

  + **Function**: `which.max()` is a built-in R function that returns the index of the first maximum value in its input.
  + **Input**: In this case, the input is `orders`, which is the table we created earlier containing the counts of each order in the dataset.
  + **Output**: The function identifies the **index** position of the maximum count (i.e., the highest frequency) in the `orders` table. In our case "Rodentia" is at position 24 in the table.
  
2. `names(...)`:

  + **Function**: The `names()` function retrieves the names (or labels) associated with the elements of an object. For example if I used `names(orders)` the function would simply return a list of all the unique orders.
  + **Usage**: By wrapping `which.max(orders)` inside `names()`, we are saying, "give me the name of the order that corresponds to the maximum frequency index returned by `which.max()`."
  + **Output**: In our case the name "Rodentia" is returned.
  
3. `most_common_order`: I've assigned the result of my `names(which.max(orders))` to a new variable using `<-`.
  
Finally, I've updated my print statement to `print(most_common_order)'. This should now print out "Rodentia" in my console when I re-run my script.
  
Phew! That took a bit of explaining. Make sure you understand what just happened. The wrapping of a function in a function is a common practice in R and things can quickly become obfuscated. It's good practice to comment your code so that you (or someone else) can quickly make sense of what is going on. Here is my final code, with comments!

```{R eval=FALSE, class.source="numberLines"}
# Read the CSV file and store its contents in 'data'.
data <- read.csv("pantheria_999.csv")

# Create a frequency table of the 'Order' column.
orders <- table(data$Order)

# Get the name of the most common order.
most_common_order <- names(which.max(orders))

# Print the most common order to the console.
print(most_common_order)
```

<h3>Feedback Please.</h3>

I really value your feedback on these materials for quantitative skills. Please rate them below and then leave some feedback. It's completely anonymous and will help me improve things if necessary. Say what you like, I have a thick skin - but feel free to leave positive comments as well as negative ones. Thank you.

```{r, results='asis', echo=FALSE}
if (knitr::is_html_output()) {
  cat('<iframe src="https://canvaswizards.org.uk/likertysplit/qs/" width="400" style="max-width: 100%" height="600"></iframe>')
}
```

## Complete your Weekly Assignments

In the BIOS103 Canvas course you will find this week's **formative** and **summative** QS assignments. You should aim to complete both of these before the end of the online workshop that corresponds to this section's content. The assignments are identical in all but the following details:

   + You can attempt the **formative assignment** as many times as you like. It will not contribute to your overall score for this course. You will receive immediate feedback after submitting formative assignments. Make sure you practice this assignment until you're confident that you can get the correct answer on your own.
   + You can attempt the **summative** assignment **only once**. It will be identical to the formative assignment but will use different values and datasets. This assignment **will** contribute to your overall score for this course. Failure to complete a summative test before the stated deadline will result in a zero score. You will not receive immediate feedback after submitting summative assignments. Typically, your scores will be posted within 7 days.
   
In **ALL** cases, when you click the button to "begin" a test you will have two hours to complete and submit the questions. If the test times out it will automatically submit.
